<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add</title>
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/editor.css')}}"/>
</head>
{% extends 'index.html' %}

{% block content %}
<div id="main" style="position: absolute; left:50%; top:50%; transform:translate(-50%, -50%); display:lnline-block;">
    <form id="add_form">
        <label for="add_name"><b>Name</b>ï¼š
            <input type="text" 
                   name="add_name"
                   autocomplete="off" 
                   placeholder="Enter Name Here" 
                   value="{{ selectedSim.name() }}">
        </label>
        <div id=editorContainer>
            <div id="editor">{{ selectedSim.inpFile() }}</div>    
        </div>
        <input type="submit" class="button" value="Save">
    </form>
</div>
<script src="{{ url_for('static', filename='js/ace.js') }}" type="text/javascript" charset="utf-8"></script> 
<script src="{{ url_for('static', filename='js/ext-language_tools.js') }}"></script>
<script>
    ace.require("ext/language_tools");
    let editor = ace.edit("editor");//loading ace editor
    editor.setTheme("ace/theme/monokai");//set theme
    editor.getSession().setMode("ace/mode/lua");//language set-up
    editor.setFontSize(14)
    editor.setOptions({
        enableLiveAutocompletion: true,
        enableBasicAutocompletion: true,
    });

    window.addEventListener('load', () => {
    const add_form = document.getElementById("add_form");
    add_form.addEventListener('submit', e => {
        e.preventDefault();
        const path = new URL(window.location).pathname.split('/'); // ["", "sim", "uuid"]
        const id = path[path.length - 1];
        const name = e.target[0].value;
        const inpFile = editor.getValue();
        fetch(`http://${window.location.host}/adding`, { //fetch API, sending info to this url with optional parameters
            method: 'POST',
            headers: {
                "content-type":"application/json"
            },
            body: JSON.stringify({
                id,
                name,
                inpFile
            }),
            redirect: 'manual'
        })
        .then(result => result.json())
        .then(data =>window.location.assign(data.path))
    });
});
</script>
{% endblock %}